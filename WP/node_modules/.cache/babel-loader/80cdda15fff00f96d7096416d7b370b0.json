{"ast":null,"code":"import _toConsumableArray from\"D:/WORDPRESS/UFATOP1/WP/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"D:/WORDPRESS/UFATOP1/WP/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"D:/WORDPRESS/UFATOP1/WP/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from'react';import'./App.css';import i18n from'./i18n';import{useTranslation}from'react-i18next';import fetchJsonp from'fetch-jsonp';import PageCarousel from'./components/PageCarousel';import Settings from'./components/Settings';import Header from'./components/Header';import ActionButtons from'./components/ActionButtons';import Footer from'./components/Footer';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var STORED_VALUES=JSON.parse(localStorage.getItem('wpShow')||'{}');/**\n * Main stateles component \n */function App(){var _useTranslation=useTranslation(),t=_useTranslation.t;// Hook with miscellaneous state variables\nvar _useState=useState({wpSite:STORED_VALUES.wpSite||'',interval:STORED_VALUES.interval||10,ready:false,err:null,loading:false,categories:null,tags:null,pages:null,posts:null,dateFrom:new Date(STORED_VALUES.from||Date.now()),dateTo:new Date(STORED_VALUES.to||Date.now()),dateFirst:new Date(),includeCategoryPages:!(STORED_VALUES.includeCategoryPages===false),includeTagPages:STORED_VALUES.includeTagPages===true,randomOrder:!(STORED_VALUES.randomOrder===false),numUrls:0}),_useState2=_slicedToArray(_useState,2),conf=_useState2[0],setConf=_useState2[1];// Specific hook for 'playing'\nvar _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),playing=_useState4[0],setPlaying=_useState4[1];// Always check if fetch responses have the 'ok' attribute \nvar handleFetchErrors=function handleFetchErrors(response){if(!response.ok)throw Error(response.statusText||'Error desconegut');return response;};// Obtain information from the WordPress site fetching multiple API services\nvar checkSite=function checkSite(){// Remove trailing slashes, if any\nvar base=conf.wpSite;while(base.endsWith('/')){base=base.substr(0,base.length-1);}// Set the `loading` flag and reset conf to default values\nsetConf(_objectSpread(_objectSpread({},conf),{},{wpSite:base,err:null,loading:true,categories:null,pages:null,posts:null,numUrls:0}));// Initialize main arrays and launch API queries\nvar categories=[],tags=[],posts=[],pages=[];Promise.all([apiQuery(base,'categories',['id','link','name','count'],categories),apiQuery(base,'tags',['id','link','name','count'],tags),apiQuery(base,'pages',['id','link','modified','type','status','title'],pages),apiQuery(base,'posts',['id','link','modified','type','status','title','categories','tags'],posts)]).then(function(){if(categories.length===0)throw new Error(\"ERROR ไม่มีหมวดหมู่\");// Select only categories and tags with at least one post, and sort them alphabetically\ncategories=categories.filter(function(cat){return cat.count>0;}).sort(function(a,b){return a.name<b.name?-1:1;});tags=tags.filter(function(tag){return tag.count>0;}).sort(function(a,b){return a.name<b.name?-1:1;});// Clear stored values if 'wpSite' has changed\nif(base!==STORED_VALUES.wpSite)Object.assign(STORED_VALUES,{categories:[],tags:[],pages:[],posts:[]});// Set the initial `selected` state for all items\nvar sss=[STORED_VALUES.categories,STORED_VALUES.tags,STORED_VALUES.pages,STORED_VALUES.posts];[categories,tags,pages,posts].forEach(function(set,i){return set.forEach(function(el){return el.selected=sss[i].includes(el.id);});});// Convert the 'modified' string to Date objects, and find the oldest one\nvar firstDate=new Date();[pages,posts].forEach(function(set){set.forEach(function(el){el.modified=new Date(el.modified);if(el.modified<firstDate)firstDate=el.modified;});set.sort(function(a,b){return a.modified>b.modified?-1:a.modified<b.modified?1:a.title<b.title?-1:1;});});// Move `firstDate` back one day\nvar from=STORED_VALUES.from||firstDate-24*60*60*1000;// Set inRange flag to `true` for all published posts and plages\nposts.forEach(function(post){return post.inRange=post.type==='post'&&post.status==='publish'&&post.modified>=from;});pages.forEach(function(page){return page.inRange=page.type==='page'&&page.status==='publish';});// Unset `loading` and save the new state\nvar includeCategoryPages=conf.includeCategoryPages,includeTagPages=conf.includeTagPages;setConf(_objectSpread(_objectSpread({},conf),{},{loading:false,categories:categories,tags:tags,pages:pages,posts:posts,dateFirst:new Date(firstDate),dateFrom:new Date(from),dateTo:new Date(),numUrls:doCountUrls({pages:pages,posts:posts,categories:categories,tags:tags,includeCategoryPages:includeCategoryPages,includeTagPages:includeTagPages}),err:null}));}).catch(function(err){console.log(\"Error fetching data: \".concat(err.message));setConf(_objectSpread(_objectSpread({},conf),{},{loading:false,err:err.message}));});};// Query the WordPress REST API obtaining all the information related to one type of data\n// Results are obtained with paginated calls using the max size (100 records per call)\n// and requesting only specific fields \nvar apiQuery=function apiQuery(base,query,fields){var result=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];var pageSize=arguments.length>4&&arguments[4]!==undefined?arguments[4]:100;var page=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var pages=arguments.length>6&&arguments[6]!==undefined?arguments[6]:1;// Build the API URL\nvar url=\"\".concat(base,\"/wp-json/wp/v2/\").concat(query,\"/?page=\").concat(++page,\"&per_page=\").concat(pageSize,\"&_envelope=1&\").concat(fields.map(function(f){return\"_fields[]=\".concat(f);}).join('&'));console.log(\"Fetching page \".concat(page,\"/\").concat(pages,\" of \").concat(url));// If there are more pages, prepare a recursive call to get more data\n// Return `result` otherwise\nvar next=function next(){return page<pages?apiQuery(base,query,fields,result,pageSize,page,pages):result;};// Avoid CORS issues fetching the API in JSONP mode\nreturn fetchJsonp(url,{jsonpCallback:'_jsonp',timeout:7000}).then(function(response){return handleFetchErrors(response);}).then(function(response){return response.json();}).then(function(data){// Read the total number of pages\nif(data.headers&&data.headers['X-WP-TotalPages'])pages=data.headers['X-WP-TotalPages'];if(data.body)result.push.apply(result,_toConsumableArray(data.body));// This will return `result` or just a promise call to the next page of results\nreturn next();}).catch(function(err){console.log(\"Error fetching page \".concat(page,\" of \").concat(query,\": \").concat(err));// Make the API call tolerant to errors, returning always the accumulated result\nreturn next();});};// Mark as selected posts created or updated between the specified dates, and\n// related to at least one selected category  \nvar selectPostsByDateAndCategory=function selectPostsByDateAndCategory(){var dateFrom=arguments.length>0&&arguments[0]!==undefined?arguments[0]:conf.dateFrom;var dateTo=arguments.length>1&&arguments[1]!==undefined?arguments[1]:conf.dateTo;var posts=arguments.length>2&&arguments[2]!==undefined?arguments[2]:conf.posts;var updateConf=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;// Get the ids of selected categories\n//const activeCategories = [], activetags=[];\nvar activeCategories=conf.categories.filter(function(cat){return cat.selected;}).map(function(cat){return cat.id;});var activeTags=conf.tags.filter(function(tag){return tag.selected;}).map(function(tag){return tag.id;});// Select or unselect posts based on its date and categories\nposts.forEach(function(post){var categories=post.categories,tags=post.tags,modified=post.modified,type=post.type,status=post.status;post.inRange=modified>=dateFrom&&modified<=dateTo&&type==='post'&&status==='publish';post.selected=post.inRange&&(categories.map(function(cat){return activeCategories.includes(cat);}).includes(true)||tags.map(function(tag){return activeTags.includes(tag);}).includes(true));});// Update dates and clear the error flag, if set\nif(updateConf)setConf(_objectSpread(_objectSpread({},conf),{},{dateFrom:dateFrom,dateTo:dateTo,err:null,numUrls:countUrls(false)}));};// Get the final list of URLs used in the carousel, maybe randomized\nvar getUrls=function getUrls(){var posts=conf.posts,pages=conf.pages,categories=conf.categories,tags=conf.tags,includeCategoryPages=conf.includeCategoryPages,includeTagPages=conf.includeTagPages,randomOrder=conf.randomOrder;var urls=[];urls.push.apply(urls,_toConsumableArray(posts.filter(function(post){return post.selected;}).map(function(post){return post.link;})));urls.push.apply(urls,_toConsumableArray(pages.filter(function(page){return page.selected;}).map(function(page){return page.link;})));if(includeCategoryPages)urls.push.apply(urls,_toConsumableArray(categories.filter(function(cat){return cat.selected;}).map(function(cat){return cat.link;})));if(includeTagPages)urls.push.apply(urls,_toConsumableArray(tags.filter(function(cat){return cat.selected;}).map(function(cat){return cat.link;})));return randomOrder?shuffle(urls):urls;};// Count the current number of valid URLs\nvar countUrls=function countUrls(){var updateConf=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var numUrls=doCountUrls(conf);if(updateConf)setConf(_objectSpread(_objectSpread({},conf),{},{numUrls:numUrls}));return numUrls;};var doCountUrls=function doCountUrls(_ref){var pages=_ref.pages,posts=_ref.posts,categories=_ref.categories,tags=_ref.tags,includeCategoryPages=_ref.includeCategoryPages,includeTagPages=_ref.includeTagPages;return pages.filter(function(page){return page.selected;}).length+posts.filter(function(post){return post.selected;}).length+(includeCategoryPages?categories.filter(function(cat){return cat.selected;}).length:0)+(includeTagPages?tags.filter(function(tag){return tag.selected;}).length:0);};// Shuffle the provided array using the Fisher-Yates (aka Knuth) algorithm\n// See: https://stackoverflow.com/questions/2450954/how-to-randomize-shuffle-a-javascript-array\nvar shuffle=function shuffle(array){var currentIndex=array.length;// While there remain elements to shuffle...\nwhile(0!==currentIndex){// Pick a remaining element...\nvar randomIndex=Math.floor(Math.random()*currentIndex);currentIndex-=1;// And swap it with the current element.\nvar temporaryValue=array[currentIndex];array[currentIndex]=array[randomIndex];array[randomIndex]=temporaryValue;}return array;};var saveSettings=function saveSettings(){// Update the `STORED_VALUES` object\nObject.assign(STORED_VALUES,{wpSite:conf.wpSite,interval:conf.interval,from:conf.dateFrom.getTime(),to:conf.dateTo.getTime(),includeCategoryPages:conf.includeCategoryPages,includeTagPages:conf.includeTagPages,randomOrder:conf.randomOrder,categories:conf.categories.filter(function(e){return e.selected;}).map(function(e){return e.id;}),tags:conf.tags.filter(function(e){return e.selected;}).map(function(e){return e.id;}),pages:conf.pages.filter(function(e){return e.selected;}).map(function(e){return e.id;}),posts:conf.posts.filter(function(e){return e.selected;}).map(function(e){return e.id;})});// Save settings in browser's local storage\nlocalStorage.setItem('wpShow',JSON.stringify(STORED_VALUES));};// Main content\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"App\",children:[!playing&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Header,{t:t,i18n:i18n}),/*#__PURE__*/_jsx(Settings,{conf:conf,setConf:setConf,checkSite:checkSite,selectPostsByDateAndCategory:selectPostsByDateAndCategory,countUrls:countUrls,t:t,i18n:i18n}),/*#__PURE__*/_jsx(ActionButtons,{conf:conf,saveSettings:saveSettings,i18n:i18n,t:t,getUrls:getUrls,setPlaying:setPlaying}),/*#__PURE__*/_jsx(Footer,{t:t})]}),playing&&/*#__PURE__*/_jsx(PageCarousel,{urls:getUrls(),interval:conf.interval})]});}export default App;","map":{"version":3,"sources":["D:/WORDPRESS/UFATOP1/wp/src/App.js"],"names":["React","useState","i18n","useTranslation","fetchJsonp","PageCarousel","Settings","Header","ActionButtons","Footer","STORED_VALUES","JSON","parse","localStorage","getItem","App","t","wpSite","interval","ready","err","loading","categories","tags","pages","posts","dateFrom","Date","from","now","dateTo","to","dateFirst","includeCategoryPages","includeTagPages","randomOrder","numUrls","conf","setConf","playing","setPlaying","handleFetchErrors","response","ok","Error","statusText","checkSite","base","endsWith","substr","length","Promise","all","apiQuery","then","filter","cat","count","sort","a","b","name","tag","Object","assign","sss","forEach","set","i","el","selected","includes","id","firstDate","modified","title","post","inRange","type","status","page","doCountUrls","catch","console","log","message","query","fields","result","pageSize","url","map","f","join","next","jsonpCallback","timeout","json","data","headers","body","push","selectPostsByDateAndCategory","updateConf","activeCategories","activeTags","countUrls","getUrls","urls","link","shuffle","array","currentIndex","randomIndex","Math","floor","random","temporaryValue","saveSettings","getTime","e","setItem","stringify"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\nimport './App.css';\nimport i18n from './i18n';\nimport { useTranslation } from 'react-i18next';\nimport fetchJsonp from 'fetch-jsonp';\nimport PageCarousel from './components/PageCarousel';\nimport Settings from './components/Settings';\nimport Header from './components/Header';\nimport ActionButtons from './components/ActionButtons';\nimport Footer from './components/Footer';\n\n\nconst STORED_VALUES = JSON.parse(localStorage.getItem('wpShow') || '{}');\n\n/**\n * Main stateles component \n */\nfunction App() {\n\n  const { t } = useTranslation();\n\n  // Hook with miscellaneous state variables\n  const [conf, setConf] = useState({\n    wpSite: STORED_VALUES.wpSite || '',\n    interval: STORED_VALUES.interval || 10,\n    ready: false,\n    err: null,\n    loading: false,\n    categories: null,\n    tags: null,\n    pages: null,\n    posts: null,\n    dateFrom: new Date(STORED_VALUES.from || Date.now()),\n    dateTo: new Date(STORED_VALUES.to || Date.now()),\n    dateFirst: new Date(),\n    includeCategoryPages: !(STORED_VALUES.includeCategoryPages === false),\n    includeTagPages: STORED_VALUES.includeTagPages === true,\n    randomOrder: !(STORED_VALUES.randomOrder === false),\n    numUrls: 0,\n  });\n\n  // Specific hook for 'playing'\n  const [playing, setPlaying] = useState(false);\n\n  // Always check if fetch responses have the 'ok' attribute \n  const handleFetchErrors = (response) => {\n    if (!response.ok)\n      throw Error(response.statusText || 'Error desconegut');\n    return response;\n  }\n\n  // Obtain information from the WordPress site fetching multiple API services\n  const checkSite = () => {\n\n    // Remove trailing slashes, if any\n    let base = conf.wpSite;\n    while (base.endsWith('/'))\n      base = base.substr(0, base.length - 1);\n\n    // Set the `loading` flag and reset conf to default values\n    setConf({\n      ...conf,\n      wpSite: base,\n      err: null,\n      loading: true,\n      categories: null,\n      pages: null,\n      posts: null,\n      numUrls: 0,\n    });\n\n    // Initialize main arrays and launch API queries\n    let categories = [], tags = [], posts = [], pages = [];\n    Promise.all([\n      apiQuery(base, 'categories', ['id', 'link', 'name', 'count'], categories),\n      apiQuery(base, 'tags', ['id', 'link', 'name', 'count'], tags),\n      apiQuery(base, 'pages', ['id', 'link', 'modified', 'type', 'status', 'title'], pages),\n      apiQuery(base, 'posts', ['id', 'link', 'modified', 'type', 'status', 'title', 'categories', 'tags'], posts),\n    ])\n      .then(() => {\n        if (categories.length === 0)\n          throw new Error(\"ERROR ไม่มีหมวดหมู่\");\n\n        // Select only categories and tags with at least one post, and sort them alphabetically\n        categories = categories.filter(cat => cat.count > 0).sort((a, b) => a.name < b.name ? -1 : 1);\n        tags = tags.filter(tag => tag.count > 0).sort((a, b) => a.name < b.name ? -1 : 1);\n\n        // Clear stored values if 'wpSite' has changed\n        if (base !== STORED_VALUES.wpSite)\n          Object.assign(STORED_VALUES, { categories: [], tags: [], pages: [], posts: [] });\n\n        // Set the initial `selected` state for all items\n        const sss = [STORED_VALUES.categories, STORED_VALUES.tags, STORED_VALUES.pages, STORED_VALUES.posts];\n        [categories, tags, pages, posts].forEach((set, i) => set.forEach(el => el.selected = sss[i].includes(el.id)));\n\n        // Convert the 'modified' string to Date objects, and find the oldest one\n        let firstDate = new Date();\n        [pages, posts].forEach(set => {\n          set.forEach(el => {\n            el.modified = new Date(el.modified)\n            if (el.modified < firstDate)\n              firstDate = el.modified;\n          });\n          set.sort((a, b) => {\n            return a.modified > b.modified ? -1\n              : a.modified < b.modified ? 1\n                : a.title < b.title ? -1 : 1;\n          });\n        });\n\n        // Move `firstDate` back one day\n        let from = STORED_VALUES.from || firstDate - 24 * 60 * 60 * 1000;\n\n        // Set inRange flag to `true` for all published posts and plages\n        posts.forEach(post => post.inRange = post.type === 'post' && post.status === 'publish' && post.modified >= from);\n        pages.forEach(page => page.inRange = page.type === 'page' && page.status === 'publish');\n\n        // Unset `loading` and save the new state\n        const { includeCategoryPages, includeTagPages } = conf;\n        setConf({\n          ...conf,\n          loading: false,\n          categories, tags, pages, posts,\n          dateFirst: new Date(firstDate),\n          dateFrom: new Date(from),\n          dateTo: new Date(),\n          numUrls: doCountUrls({ pages, posts, categories, tags, includeCategoryPages, includeTagPages }),\n          err: null,\n        });\n\n      })\n      .catch(err => {\n        console.log(`Error fetching data: ${err.message}`);\n        setConf({ ...conf, loading: false, err: err.message });\n      })\n  }\n\n  // Query the WordPress REST API obtaining all the information related to one type of data\n  // Results are obtained with paginated calls using the max size (100 records per call)\n  // and requesting only specific fields \n  const apiQuery = (base, query, fields, result = [], pageSize = 100, page = 0, pages = 1) => {\n    // Build the API URL\n    const url = `${base}/wp-json/wp/v2/${query}/?page=${++page}&per_page=${pageSize}&_envelope=1&${fields.map(f => `_fields[]=${f}`).join('&')}`;\n\n    console.log(`Fetching page ${page}/${pages} of ${url}`);\n\n    // If there are more pages, prepare a recursive call to get more data\n    // Return `result` otherwise\n    const next = () => page < pages\n      ? apiQuery(base, query, fields, result, pageSize, page, pages)\n      : result;\n\n    // Avoid CORS issues fetching the API in JSONP mode\n    return fetchJsonp(url, {\n      jsonpCallback: '_jsonp',\n      timeout: 7000,\n    })\n      .then(response => handleFetchErrors(response))\n      .then(response => response.json())\n      .then(data => {\n        // Read the total number of pages\n        if (data.headers && data.headers['X-WP-TotalPages'])\n          pages = data.headers['X-WP-TotalPages'];\n        if (data.body)\n          result.push(...data.body);\n        // This will return `result` or just a promise call to the next page of results\n        return next();\n      })\n      .catch(err => {\n        console.log(`Error fetching page ${page} of ${query}: ${err}`);\n        // Make the API call tolerant to errors, returning always the accumulated result\n        return next();\n      });\n  }\n\n  // Mark as selected posts created or updated between the specified dates, and\n  // related to at least one selected category  \n  const selectPostsByDateAndCategory = (dateFrom = conf.dateFrom, dateTo = conf.dateTo, posts = conf.posts, updateConf = true) => {\n\n    // Get the ids of selected categories\n    //const activeCategories = [], activetags=[];\n    const activeCategories = conf.categories.filter(cat => cat.selected).map(cat => cat.id);\n    const activeTags = conf.tags.filter(tag => tag.selected).map(tag => tag.id);\n\n    // Select or unselect posts based on its date and categories\n    posts.forEach(post => {\n      const { categories, tags, modified, type, status } = post;\n      post.inRange = modified >= dateFrom && modified <= dateTo && type === 'post' && status === 'publish';\n      post.selected = post.inRange && (\n        categories.map(cat => activeCategories.includes(cat)).includes(true) ||\n        tags.map(tag => activeTags.includes(tag)).includes(true)\n      );\n    });\n\n    // Update dates and clear the error flag, if set\n    if (updateConf)\n      setConf({ ...conf, dateFrom, dateTo, err: null, numUrls: countUrls(false) });\n  }\n\n  // Get the final list of URLs used in the carousel, maybe randomized\n  const getUrls = () => {\n    const { posts, pages, categories, tags, includeCategoryPages, includeTagPages, randomOrder } = conf;\n    const urls = [];\n    urls.push(...posts.filter(post => post.selected).map(post => post.link));\n    urls.push(...pages.filter(page => page.selected).map(page => page.link));\n    if (includeCategoryPages)\n      urls.push(...categories.filter(cat => cat.selected).map(cat => cat.link));\n    if (includeTagPages)\n      urls.push(...tags.filter(cat => cat.selected).map(cat => cat.link));\n\n    return randomOrder ? shuffle(urls) : urls;\n  }\n\n  // Count the current number of valid URLs\n  const countUrls = (updateConf = true) => {\n    const numUrls = doCountUrls(conf);\n    if (updateConf)\n      setConf({ ...conf, numUrls });\n    return numUrls;\n  }\n\n  const doCountUrls = ({ pages, posts, categories, tags, includeCategoryPages, includeTagPages }) => {\n    return pages.filter(page => page.selected).length\n      + posts.filter(post => post.selected).length\n      + (includeCategoryPages ? categories.filter(cat => cat.selected).length : 0)\n      + (includeTagPages ? tags.filter(tag => tag.selected).length : 0);\n  }\n\n  // Shuffle the provided array using the Fisher-Yates (aka Knuth) algorithm\n  // See: https://stackoverflow.com/questions/2450954/how-to-randomize-shuffle-a-javascript-array\n  const shuffle = array => {\n    let currentIndex = array.length;\n    // While there remain elements to shuffle...\n    while (0 !== currentIndex) {\n      // Pick a remaining element...\n      const randomIndex = Math.floor(Math.random() * currentIndex);\n      currentIndex -= 1;\n      // And swap it with the current element.\n      let temporaryValue = array[currentIndex];\n      array[currentIndex] = array[randomIndex];\n      array[randomIndex] = temporaryValue;\n    }\n    return array;\n  }\n\n  const saveSettings = () => {\n    // Update the `STORED_VALUES` object\n    Object.assign(STORED_VALUES, {\n      wpSite: conf.wpSite,\n      interval: conf.interval,\n      from: conf.dateFrom.getTime(),\n      to: conf.dateTo.getTime(),\n      includeCategoryPages: conf.includeCategoryPages,\n      includeTagPages: conf.includeTagPages,\n      randomOrder: conf.randomOrder,\n      categories: conf.categories.filter(e => e.selected).map(e => e.id),\n      tags: conf.tags.filter(e => e.selected).map(e => e.id),\n      pages: conf.pages.filter(e => e.selected).map(e => e.id),\n      posts: conf.posts.filter(e => e.selected).map(e => e.id),\n    });\n\n    // Save settings in browser's local storage\n    localStorage.setItem('wpShow', JSON.stringify(STORED_VALUES));\n  }\n\n  // Main content\n  return (\n    <div className=\"App\">\n      {!playing &&\n        <div>\n          <Header {...{ t, i18n }} />\n          <Settings {...{ conf, setConf, checkSite, selectPostsByDateAndCategory, countUrls, t, i18n }} />\n          <ActionButtons {...{ conf, saveSettings, i18n, t, getUrls, setPlaying }} />\n          <Footer {...{ t }} />\n        </div>\n      }\n      {playing &&\n        <PageCarousel urls={getUrls()} interval={conf.interval} />\n      }\n    </div>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}